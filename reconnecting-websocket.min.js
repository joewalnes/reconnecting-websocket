!function(a,b){"function"==typeof define&&define.amd?define([],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.ReconnectingWebSocket=b()}(this,function(){function a(b,c,d){function e(a,b){var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,!1,!1,b),c}var f={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:3e3,maxReconnectAttempts:50};d||(d={});for(var g in f)"undefined"!=typeof d[g]?this[g]=d[g]:this[g]=f[g];this.url=b,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING,this.protocol=null;var h,i=this,j=!1,k=!1,l=document.createElement("div");l.addEventListener("open",function(a){i.onopen(a)}),l.addEventListener("close",function(a){i.onclose(a)}),l.addEventListener("connecting",function(a){i.onconnecting(a)}),l.addEventListener("message",function(a){i.onmessage(a)}),l.addEventListener("error",function(a){i.onerror(a)}),l.addEventListener("maxAttemptsExceed",function(a){i.onmaxattemptsexceed(a)}),this.addEventListener=l.addEventListener.bind(l),this.removeEventListener=l.removeEventListener.bind(l),this.dispatchEvent=l.dispatchEvent.bind(l),this.open=function(b){if(h=new WebSocket(i.url,c||[]),b){if(this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts)return void l.dispatchEvent(e("maxAttemptsExceed"))}else l.dispatchEvent(e("connecting")),this.reconnectAttempts=0;i.debug||a.debugAll;var d=h,f=setTimeout(function(){i.debug||a.debugAll,k=!0,d.close(),k=!1},i.timeoutInterval);h.onopen=function(c){clearTimeout(f),i.debug||a.debugAll,i.protocol=h.protocol,i.readyState=WebSocket.OPEN,i.reconnectAttempts=0;var d=e("open");d.isReconnect=b,b=!1,l.dispatchEvent(d)},h.onclose=function(c){if(clearTimeout(f),h=null,j)i.readyState=WebSocket.CLOSED,l.dispatchEvent(e("close"));else{i.readyState=WebSocket.CONNECTING;var d=e("connecting");d.code=c.code,d.reason=c.reason,d.wasClean=c.wasClean,l.dispatchEvent(d),b||k||(i.debug||a.debugAll,l.dispatchEvent(e("close")));var g=i.reconnectInterval*Math.pow(i.reconnectDecay,i.reconnectAttempts);setTimeout(function(){i.reconnectAttempts++,i.open(!0)},g>i.maxReconnectInterval?i.maxReconnectInterval:g)}},h.onmessage=function(b){i.debug||a.debugAll;var c=e("message");c.data=b.data,l.dispatchEvent(c)},h.onerror=function(b){i.debug||a.debugAll,l.dispatchEvent(e("error"))}},this.automaticOpen===!0&&this.open(!1),this.send=function(b){if(h)return i.debug||a.debugAll,h.send(b);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(a,b){"undefined"==typeof a&&(a=1e3),j=!0,h&&h.close(a,b)},this.refresh=function(){h&&h.close()}}if("WebSocket"in window)return a.prototype.onopen=function(a){},a.prototype.onclose=function(a){},a.prototype.onconnecting=function(a){},a.prototype.onmessage=function(a){},a.prototype.onerror=function(a){},a.prototype.onmaxattemptsexceed=function(a){},a.debugAll=!1,a.CONNECTING=WebSocket.CONNECTING,a.OPEN=WebSocket.OPEN,a.CLOSING=WebSocket.CLOSING,a.CLOSED=WebSocket.CLOSED,a});